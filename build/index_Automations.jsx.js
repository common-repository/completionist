(()=>{"use strict";const t=window.ReactJSXRuntime,{Component:e}=wp.element;class s extends e{constructor(t){super(t),this.state={...t.automation,isDeleting:!1},this.goToAutomation=t.goToAutomation,this.deleteAutomation=this.deleteAutomation.bind(this)}deleteAutomation(){this.setState({isDeleting:!0},(()=>{this.props.deleteAutomation(this.state.ID,(()=>{this.setState({isDeleting:!1})}))}))}render(){return(0,t.jsxs)("div",{className:"ptc-completionist-automation-row",children:[(0,t.jsxs)("header",{children:[(0,t.jsx)("h2",{title:"Automation ID: "+this.state.ID,onClick:()=>this.goToAutomation(this.state.ID),children:this.state.title}),(0,t.jsx)("p",{className:"last-modified",children:(0,t.jsxs)("em",{children:["Updated ",this.state.last_modified]})}),this.state.description.length>0&&(0,t.jsx)("p",{className:"description",dangerouslySetInnerHTML:{__html:this.state.description}}),(0,t.jsxs)("div",{className:"automation-actions",children:[(0,t.jsxs)("button",{className:"edit",onClick:()=>this.goToAutomation(this.state.ID),children:[(0,t.jsx)("i",{className:"fas fa-pen"})," Edit"]}),(0,t.jsxs)("button",{className:"delete",onClick:this.deleteAutomation,disabled:this.state.isDeleting,children:[(0,t.jsx)("i",{className:"fas fa-trash"})," Delete"]})]})]}),(0,t.jsxs)("ul",{children:[(0,t.jsx)("li",{title:this.state.total_conditions+" Conditions",children:this.state.total_conditions}),(0,t.jsx)("li",{title:this.state.total_actions+" Actions",children:this.state.total_actions}),(0,t.jsx)("li",{title:"Triggered "+this.state.total_triggered+" times",children:this.state.total_triggered}),(0,t.jsx)("li",{title:"Last Triggered "+this.state.last_triggered,children:this.state.last_triggered})]})]})}}const{Component:o}=wp.element;class i extends o{constructor(t){super(t),this.state={automations:t.automations,orderBy:"title"},this.goToAutomation=t.goToAutomation}sortAutomationsListing(t="title"){}componentDidUpdate(t){this.props.automations!==t.automations&&this.setState({automations:this.props.automations})}render(){const e=this.state.automations.map((e=>(0,t.jsx)(s,{automation:e,goToAutomation:this.goToAutomation,deleteAutomation:this.props.deleteAutomation},e.ID)));return(0,t.jsxs)("div",{className:"ptc-completionist-automations-listing",children:[(0,t.jsxs)("div",{className:"title",children:[(0,t.jsx)("h1",{children:"Automations"}),(0,t.jsx)("div",{className:"actions",children:(0,t.jsxs)("button",{onClick:()=>this.goToAutomation("new"),children:[(0,t.jsx)("i",{className:"fas fa-plus"})," Add New"]})})]}),(0,t.jsxs)("header",{children:[(0,t.jsx)("div",{children:"Automation"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("i",{className:"fas fa-question"})," Conditions"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("i",{className:"fas fa-running"})," Actions"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("i",{className:"fas fa-bolt"})," Triggers"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("i",{className:"fas fa-history"})," Last Triggered"]})]}),(0,t.jsx)("div",{className:"ptc-completionist-automations-list",children:e})]})}}const{Component:a}=wp.element;class n extends a{constructor(t){super(t),this.state={isLoading:!1,currentRequest:{},textInputHasFocus:!1,options:[],currentValue:"",currentLabel:""},"initialValue"in t&&t.initialValue&&(this.state.currentValue=t.initialValue),"initialLabel"in t&&t.initialLabel&&(this.state.currentLabel=t.initialLabel),"suggestedOptions"in t&&t.suggestedOptions&&(this.state.suggestedOptions=t.suggestedOptions),this.handleSearchChange=this.handleSearchChange.bind(this),this.handleOptionChange=this.handleOptionChange.bind(this),this.createSelectOptions=this.createSelectOptions.bind(this),this.handleSearchBlur=this.handleSearchBlur.bind(this)}handleSearchChange(t){t.trim().length>=3?this.setState({isLoading:!0,currentValue:"",currentLabel:t,options:[]},(()=>{let t={_wpnonce:window.ptc_completionist_automations.api.auth_nonce,nonce:window.ptc_completionist_automations.api.nonce_get_post,like:`%${this.state.currentLabel}%`,limit:20,offset:0},e=window.jQuery.getJSON(`${window.ptc_completionist_automations.api.v1}/posts/where-title-like`,t,(t=>{if("success"!==t?.status||!t?.data?.posts)throw t?.message?t.message:"unknown error";this.setState({isLoading:!1,currentRequest:{},options:t.data.posts})})).fail(((t,e)=>{"abort"!=e&&(alert("Failed to search for posts by title."),this.setState({isLoading:!1,options:[]}))}));this.setState((t=>("object"==typeof t.currentRequest&&"function"==typeof t.currentRequest.abort&&this.state.currentRequest.abort(),{currentRequest:e})))})):this.setState({isLoading:!1,currentValue:"",currentLabel:t,options:[]})}handleOptionChange(t,e){this.setState((s=>({currentValue:t,currentLabel:e})),(()=>{this.props.onSelectOption(this.state.currentValue)}))}handleSearchBlur(){this.setState((t=>({textInputHasFocus:!1,currentLabel:""===t.currentValue?"":t.currentLabel})))}createSelectOptions(){return this.state.options.length<1?!0===this.state.isLoading?(0,t.jsxs)("li",{children:[(0,t.jsx)("i",{className:"fas fa-spinner fa-pulse"})," Searching for posts..."]}):this.state.currentLabel.trim().length>=3?(0,t.jsxs)("li",{children:["No post results. ",this.state?.suggestedOptions?.length>0&&"Clear your search to see suggested options."]}):this.state?.suggestedOptions?.length>0?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("li",{children:"Choose an option below or enter at least 3 characters to search..."}),this.state.suggestedOptions.map((e=>(0,t.jsx)("li",{className:"post-option","data-value":e.value,onMouseDown:()=>this.handleOptionChange(e.value,e.label),children:e.label},e.value)))]}):(0,t.jsx)("li",{children:"Enter at least 3 characters to search..."}):this.state.options.map((e=>(0,t.jsx)("li",{className:"post-option","data-value":e.ID,onMouseDown:()=>this.handleOptionChange(e.ID,e.post_title),children:e.post_title+" ["+e.ID+"]"},e.ID)))}componentDidMount(){""!==this.state.currentValue.trim()&&""===this.state.currentLabel.trim()&&this.setState({currentLabel:"(Loading...)"},(()=>{if(Number.isNaN(parseFloat(this.state.currentValue))||!Number.isFinite(this.state.currentValue))return void this.setState({currentLabel:this.state.currentValue});let t={_wpnonce:window.ptc_completionist_automations.api.auth_nonce,nonce:window.ptc_completionist_automations.api.nonce_get_post,post_fields:["post_title"]};window.jQuery.getJSON(`${window.ptc_completionist_automations.api.v1}/posts/${this.state.currentValue}`,t,(t=>{"success"===t?.status&&t?.data?.post?.post_title?this.setState({currentLabel:t.data.post.post_title}):(console.error("Failed to load initial PostSearchSelectInput label for initial value."),console.error(t),this.setState({currentLabel:`${this.state.currentValue} - [Error] Failed to load post title`}))})).fail((()=>{console.error("Failed to load initial PostSearchSelectInput label for initial value."),this.setState({currentLabel:`${this.state.currentValue} - [Error] Failed to load post title`})}))}))}componentDidUpdate(t,e){this.state.currentValue!==e.currentValue&&this.props.onSelectOption(this.state.currentValue)}render(){let e=null;if(!0===this.state.textInputHasFocus){const s=this.createSelectOptions(this.state.options);e=(0,t.jsx)("ul",{className:"select-options",children:s})}return(0,t.jsxs)("div",{className:"ptc-ajax-search-select-input",children:[(0,t.jsx)("input",{id:this.props.id,type:"text",value:this.state.currentLabel,onChange:t=>this.handleSearchChange(t.target.value),onFocus:()=>this.setState({textInputHasFocus:!0}),onBlur:()=>this.handleSearchBlur()}),(0,t.jsx)("input",{type:"hidden",value:this.state.currentValue}),e]})}}const{Component:l}=wp.element;function c(t){return!0===Object.keys(window.ptc_completionist_automations.event_custom_options).some((e=>t.startsWith(e)))}function r(t){let e=Object.keys(window.ptc_completionist_automations.event_custom_options).find((e=>t.startsWith(e)));return null!=e?e:t}function d(e){return Object.keys(e).map((s=>(0,t.jsx)("option",{value:s,children:e[s]},s)))}class h extends l{constructor(t){super(t),"automation"in t?(this.state=t.automation,this.state.saveButtonLabel="Create","ID"in t.automation&&t.automation.ID>0&&(this.state.saveButtonLabel="Update"),this.state.isSubmitting=!1):this.state={ID:0,title:"",description:"",hook_name:"",last_modified:"",conditions:[],actions:[],saveButtonLabel:"Create",isSubmitting:!1},this.handleAutomationChange=this.handleAutomationChange.bind(this),this.handleConditionChange=this.handleConditionChange.bind(this),this.handleAddCondition=this.handleAddCondition.bind(this),this.handleRemoveCondition=this.handleRemoveCondition.bind(this),this.handleActionChange=this.handleActionChange.bind(this),this.handleActionMetaChange=this.handleActionMetaChange.bind(this),this.handleAddAction=this.handleAddAction.bind(this),this.handleRemoveAction=this.handleRemoveAction.bind(this)}saveAutomation(){this.state.isSubmitting||this.setState({isSubmitting:!0},(()=>{const{saveButtonLabel:t,isSubmitting:e,...s}=this.state,o={method:"PUT",url:`${window.ptc_completionist_automations.api.v1}/automations/${s.ID}`,headers:{"Content-Type":"application/json","X-WP-Nonce":window.ptc_completionist_automations.api.auth_nonce},contentType:"application/json",data:{nonce:window.ptc_completionist_automations.api.nonce_update_automation,automation:s},dataType:"json"};0===s.ID&&(o.method="POST",o.url=`${window.ptc_completionist_automations.api.v1}/automations`,o.data.nonce=window.ptc_completionist_automations.api.nonce_create_automation),o.data=JSON.stringify(o.data),window.jQuery.ajax(o).done((t=>{"success"===t?.status&&[200,201].includes(t?.code)&&t?.data?.automation?.ID>0?201===t.code?this.props.goToAutomation(t.data.automation.ID):200===t.code&&this.setState({...t.data.automation,isSubmitting:!1}):(t?.message&&t?.code?alert("Error "+t.code+". The automation could not be saved. "+t.message):alert("Error 409. The automation could not be saved."),this.setState({isSubmitting:!1}))})).fail((()=>{alert("Error 500. The automation could not be saved."),this.setState({isSubmitting:!1})}))}))}handleAutomationChange(t,e){this.setState((s=>({...s,[t]:e})))}handleConditionChange(t,e,s){this.setState((o=>({conditions:o.conditions.map((o=>o.ID===t?{...o,[e]:s}:o))})))}handleAddCondition(){this.setState((t=>({conditions:[...t.conditions,{ID:-Date.now(),property:"",comparison_method:window.ptc_completionist_automations.field_comparison_methods[0],value:""}]})))}handleRemoveCondition(t){this.setState((e=>({conditions:e.conditions.filter((e=>e.ID!==t))})))}handleActionChange(t,e){this.setState((s=>({actions:s.actions.map((s=>s.ID===t?{...s,action:e,meta:this.getDefaultActionMeta(e)}:s))})))}handleActionMetaChange(t,e,s){this.setState((o=>({actions:o.actions.map((o=>o.ID===t?{...o,meta:{...o.meta,[e]:s}}:o))})))}handleAddAction(){this.setState((t=>({actions:[...t.actions,{ID:-Date.now(),action:"create_task",triggered_count:0,last_triggered:"",meta:this.getDefaultActionMeta("create_task")}]})))}handleRemoveAction(t){this.setState((e=>({actions:e.actions.filter((e=>e.ID!==t))})))}getDefaultActionMeta(t){return"create_task"===t?{task_author:Object.keys(window.ptc_completionist_automations.connected_workspace_users)[0]}:{}}render(){return(0,t.jsxs)("div",{className:"ptc-completionist-automation-details-form",children:[(0,t.jsx)(u,{title:this.state.title,changeTitle:t=>this.handleAutomationChange("title",t),description:this.state.description,changeDescription:t=>this.handleAutomationChange("description",t)}),(0,t.jsx)(p,{hook_name:this.state.hook_name,changeEvent:t=>this.handleAutomationChange("hook_name",t)}),(0,t.jsx)(m,{event:this.state.hook_name,conditions:this.state.conditions,changeCondition:this.handleConditionChange,addCondition:this.handleAddCondition,removeCondition:this.handleRemoveCondition}),(0,t.jsx)(g,{event:this.state.hook_name,actions:this.state.actions,changeAction:this.handleActionChange,addAction:this.handleAddAction,removeAction:this.handleRemoveAction,changeActionMeta:this.handleActionMetaChange}),this.state.isSubmitting?(0,t.jsxs)("button",{className:"save-automation",onClick:()=>this.saveAutomation(),disabled:"disabled",children:[(0,t.jsx)("i",{className:"fas fa-spinner fa-pulse"})," Saving..."]}):(0,t.jsxs)("button",{className:"save-automation",onClick:()=>this.saveAutomation(),children:[(0,t.jsx)("i",{className:"fas fa-save"})," ",this.state.saveButtonLabel]})]})}}class u extends l{constructor(t){super(t)}render(){return(0,t.jsxs)("div",{className:"automation-info",children:[(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"automation-title",children:"Title"}),(0,t.jsx)("input",{id:"automation-title",type:"text",value:this.props.title,onChange:t=>this.props.changeTitle(t.target.value)})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"automation-description",children:"Description"}),(0,t.jsx)("textarea",{id:"automation-description",value:this.props.description,onChange:t=>this.props.changeDescription(t.target.value)})]})]})}}class p extends l{constructor(t){var e;super(t),this.state={selected_hook_name:r(this.props.hook_name),custom_hook_name:(e=this.props.hook_name,!0===c(e)?e.replace(r(e),""):"")},this.updateEventHookName=this.updateEventHookName.bind(this),this.handleCustomHookNameChange=this.handleCustomHookNameChange.bind(this),this.handleEventChange=this.handleEventChange.bind(this)}updateEventHookName(t){!0===c(t.selected_hook_name)?this.props.changeEvent(t.selected_hook_name+t.custom_hook_name):this.props.changeEvent(t.selected_hook_name)}handleCustomHookNameChange(t){this.setState({custom_hook_name:t},(()=>{this.updateEventHookName(this.state)}))}handleEventChange(t){this.setState({selected_hook_name:t},(()=>{this.updateEventHookName(this.state)}))}render(){const e=d(window.ptc_completionist_automations.event_user_options),s=d(window.ptc_completionist_automations.event_post_options),o=d(window.ptc_completionist_automations.event_custom_options);let i=null;return!0===c(this.state.selected_hook_name)&&(i=(0,t.jsx)("input",{type:"text",value:this.state.custom_hook_name,placeholder:"custom_hook_name",onChange:t=>this.handleCustomHookNameChange(t.target.value)})),(0,t.jsxs)("div",{className:"automation-event",children:[(0,t.jsxs)("h2",{children:[(0,t.jsx)("span",{className:"automation-step-number",children:"1"}),"Trigger Event"]}),(0,t.jsxs)("select",{value:r(this.state.selected_hook_name),onChange:t=>this.handleEventChange(t.target.value),children:[(0,t.jsx)("option",{value:"",children:"(Choose Event)"}),(0,t.jsx)("optgroup",{label:"User Events",children:e}),(0,t.jsx)("optgroup",{label:"Post Events",children:s}),(0,t.jsx)("optgroup",{label:"Custom Events",children:o})]}),i]})}}class m extends l{constructor(t){super(t),this.loadPropertyOptions=this.loadPropertyOptions.bind(this),this.loadComparisonMethodOptions=this.loadComparisonMethodOptions.bind(this),this.loadConditionFieldsets=this.loadConditionFieldsets.bind(this)}loadPropertyOptions(){Object.keys(window.ptc_completionist_automations.event_user_options).includes(this.props.event)?this.propertyOptions=d(window.ptc_completionist_automations.field_user_options):Object.keys(window.ptc_completionist_automations.event_post_options).includes(this.props.event)?this.propertyOptions=d(window.ptc_completionist_automations.field_post_options):this.propertyOptions=(0,t.jsx)("option",{children:"(Choose Event)"})}loadComparisonMethodOptions(){this.comparisonMethodOptions=window.ptc_completionist_automations.field_comparison_methods.map((e=>(0,t.jsx)("option",{value:e,children:e},e)))}loadConditionFieldsets(){!0===c(this.props.event)?this.conditionFieldsets=(0,t.jsx)("p",{className:"ptc-error-not-supported",children:"Custom events do not support conditions. Be careful when choosing a custom hook."}):this.conditionFieldsets=this.props.conditions.map((e=>{let s=null;return"is empty"!==e.comparison_method&&"is filled"!==e.comparison_method&&(s=(0,t.jsx)("input",{type:"text",value:e.value,onChange:t=>this.props.changeCondition(e.ID,"value",t.target.value),placeholder:"value"})),(0,t.jsxs)("fieldset",{className:"automation-condition",children:[(0,t.jsx)("legend",{children:"Condition"}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("select",{value:e.property,onChange:t=>this.props.changeCondition(e.ID,"property",t.target.value),children:this.propertyOptions}),(0,t.jsx)("select",{value:e.comparison_method,onChange:t=>this.props.changeCondition(e.ID,"comparison_method",t.target.value),children:this.comparisonMethodOptions}),s,(0,t.jsxs)("button",{className:"remove-item",title:"Remove Condition",onClick:()=>this.props.removeCondition(e.ID),children:[(0,t.jsx)("i",{className:"fas fa-minus"})," Delete"]})]})]},e.ID)}))}render(){let e,s=!0;return this.props.event.length?!0===c(this.props.event)?(e=(0,t.jsxs)("p",{className:"ptc-message",children:[(0,t.jsx)("strong",{children:"Custom events do not support conditions."}),"Actions will always run for the specified custom event."]}),s=!1):(this.loadPropertyOptions(),this.loadComparisonMethodOptions(),this.loadConditionFieldsets(),e=(0,t.jsxs)(t.Fragment,{children:[this.conditionFieldsets,(0,t.jsxs)("button",{className:"add-item",onClick:this.props.addCondition,children:[(0,t.jsx)("i",{className:"fas fa-plus"})," Add Condition"]})]})):(e=(0,t.jsxs)("p",{className:"ptc-message",children:[(0,t.jsx)("strong",{children:"No trigger event selected."}),"Conditions control if Actions should run after a trigger event."]}),s=!1),(0,t.jsxs)("div",{className:"automation-conditions-list",children:[(0,t.jsxs)("div",{className:"section-header",children:[(0,t.jsxs)("h2",{children:[(0,t.jsx)("span",{className:"automation-step-number",children:"2"}),"Conditions"]}),!0===s&&this.conditionFieldsets.length>1&&(0,t.jsxs)("p",{className:"ptc-message",children:[(0,t.jsx)("em",{children:"All"})," conditions must evaluate to true for the Actions to run."]})]}),e]})}}class g extends l{constructor(t){super(t),this.getActionMetaFields=this.getActionMetaFields.bind(this),this.loadActionFieldsets=this.loadActionFieldsets.bind(this)}getActionMetaFields(e,s){return"create_task"===e.action?(0,t.jsxs)("div",{className:"action-meta_create_task",children:[(0,t.jsx)("input",{id:"ptc-new-task_name_"+s,type:"text",placeholder:"Write a task name...",value:e.meta.name,onChange:t=>this.props.changeActionMeta(e.ID,"name",t.target.value)}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"ptc-new-task_task_author_"+s,children:"Creator"}),(0,t.jsx)("select",{id:"ptc-new-task_task_author_"+s,value:e.meta.task_author,onChange:t=>this.props.changeActionMeta(e.ID,"task_author",t.target.value),children:d(window.ptc_completionist_automations.connected_workspace_users)})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"ptc-new-task_assignee_"+s,children:"Assignee"}),(0,t.jsxs)("select",{id:"ptc-new-task_assignee_"+s,value:e.meta.assignee,onChange:t=>this.props.changeActionMeta(e.ID,"assignee",t.target.value),children:[(0,t.jsx)("option",{value:"",children:"None (Unassigned)"}),d(window.ptc_completionist_automations.workspace_users)]})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"ptc-new-task_due_on_"+s,children:"Due Date"}),(0,t.jsx)("input",{id:"ptc-new-task_due_on_"+s,type:"date",pattern:"\\d\\d\\d\\d-\\d\\d-\\d\\d",placeholder:"yyyy-mm-dd",value:e.meta.due_on,onChange:t=>this.props.changeActionMeta(e.ID,"due_on",t.target.value)})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"ptc-new-task_project_"+s,children:"Project"}),(0,t.jsxs)("select",{id:"ptc-new-task_project_"+s,value:e.meta.project,onChange:t=>this.props.changeActionMeta(e.ID,"project",t.target.value),children:[(0,t.jsx)("option",{value:"",children:"None (Private Task)"}),d(window.ptc_completionist_automations.workspace_projects)]})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"ptc-new-task_notes_"+s,children:"Description"}),(0,t.jsx)("textarea",{id:"ptc-new-task_notes_"+s,value:e.meta.notes,onChange:t=>this.props.changeActionMeta(e.ID,"notes",t.target.value)})]}),(0,t.jsxs)("div",{className:"form-group",style:{alignItems:"flex-start"},children:[(0,t.jsx)("label",{htmlFor:"ptc-new-task_post_id_"+s,style:{marginTop:"0.33em"},children:"Pin to Post"}),(0,t.jsx)(n,{id:"ptc-new-task_post_id_"+s,suggestedOptions:[{value:"{post.ID}",label:"{post.ID} - Dynamically pin to associated post"},{value:"{post.post_parent}",label:"{post.post_parent} - Dynamically pin to associated post's parent post"}],initialValue:e.meta.post_id,onSelectOption:t=>this.props.changeActionMeta(e.ID,"post_id",t)})]})]}):(0,t.jsx)("div",{className:"automation-meta-default",children:(0,t.jsx)("p",{children:(0,t.jsx)("em",{children:"Choose an action to see additional options."})})})}loadActionFieldsets(){let e=d(window.ptc_completionist_automations.action_options);this.actionFieldsets=this.props.actions.map(((s,o)=>(0,t.jsxs)("fieldset",{className:"automation-action",children:[(0,t.jsx)("legend",{children:"Action"}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("select",{value:s.action,onChange:t=>this.props.changeAction(s.ID,t.target.value),children:e}),(0,t.jsx)("div",{children:this.props.actions.length>1&&(0,t.jsxs)("button",{className:"remove-item",title:"Remove Action",onClick:()=>this.props.removeAction(s.ID),children:[(0,t.jsx)("i",{className:"fas fa-minus"})," Delete"]})})]}),this.getActionMetaFields(s,o)]},s.ID)))}render(){return this.loadActionFieldsets(),(0,t.jsxs)("div",{className:"automation-actions-list",children:[(0,t.jsxs)("div",{className:"section-header",children:[(0,t.jsxs)("h2",{children:[(0,t.jsx)("span",{className:"automation-step-number",children:"3"}),"Actions"]}),this.props.actions.length<=1&&(0,t.jsx)("p",{className:"ptc-message",children:"At least 1 Action is required."})]}),this.actionFieldsets,(0,t.jsxs)("button",{className:"add-item",onClick:this.props.addAction,children:[(0,t.jsx)("i",{className:"fas fa-plus"})," Add Action"]})]})}}const{Component:_}=wp.element;class j extends _{constructor(t){super(t),this.state={automations:window.ptc_completionist_automations.automations,isLoading:!1},this.goToAutomation=this.goToAutomation.bind(this),this.deleteAutomation=this.deleteAutomation.bind(this)}goToAutomation(t=0){this.setState({isLoading:!0},(()=>{if("new"===t){let e=new URLSearchParams(location.search);e.set("automation",t),history.pushState({ID:"new"},"Completionist – Add New Automation","?"+e.toString()),document.title="Completionist – Add New Automation",this.setState({isLoading:!1})}else if(isNaN(parseInt(t))||t<=0){let t={_wpnonce:window.ptc_completionist_automations.api.auth_nonce,nonce:window.ptc_completionist_automations.api.nonce_get_automation,order_by:"title",return_html:!0};window.jQuery.getJSON(`${window.ptc_completionist_automations.api.v1}/automations`,t,(t=>{if("success"==t?.status&&"object"==typeof t?.data){var e;let s=new URLSearchParams(location.search);s.delete("automation"),history.pushState({ID:0},"Completionist – Automations","?"+s.toString()),document.title="Completionist – Automations",this.setState({automations:null!==(e=t.data?.automation_overviews)&&void 0!==e?e:[],isLoading:!1})}else console.error(t),this.setState({isLoading:!1})})).fail((()=>{console.error("Failed to load automation overviews.");let t=new URLSearchParams(location.search);t.delete("automation"),history.pushState({ID:0},"Completionist – Automations","?"+t.toString()),document.title="Completionist – Automations",this.setState({isLoading:!1})}))}else{let e={_wpnonce:window.ptc_completionist_automations.api.auth_nonce,nonce:window.ptc_completionist_automations.api.nonce_get_automation};window.jQuery.getJSON(`${window.ptc_completionist_automations.api.v1}/automations/${t}`,e,(e=>{if("success"==e?.status&&"object"==typeof e?.data&&e?.data?.automation){let s="Completionist – Automation "+e.data.automation.ID+" – "+e.data.automation.title,o=new URLSearchParams(location.search);o.set("automation",t),history.pushState(e.data.automation,s,"?"+o.toString()),document.title=s,this.setState({isLoading:!1})}else console.error(e),this.goToAutomation()})).fail((()=>{console.error("Failed to get data for automation "+t),this.goToAutomation()}))}}))}deleteAutomation(t,e){window.jQuery.ajax({method:"DELETE",url:`${window.ptc_completionist_automations.api.v1}/automations/${t}`,headers:{"Content-Type":"application/json","X-WP-Nonce":window.ptc_completionist_automations.api.auth_nonce},contentType:"application/json",data:JSON.stringify({nonce:window.ptc_completionist_automations.api.nonce_delete_automation}),dataType:"json"}).done((t=>{"success"==t?.status&&200==t?.code&&t?.data?.automation_id?this.setState((e=>({automations:e.automations.filter((e=>e.ID!==t.data.automation_id))}))):t?.message&&t?.code?alert("Error "+t.code+". The automation could not be deleted. "+t.message):alert("Error. The automation could not be deleted."),"function"==typeof e&&e(t)})).fail((()=>{alert("Error 500. The automation could not be deleted."),"function"==typeof e&&e()}))}componentDidMount(){const t=new URLSearchParams(location.search).get("automation");null!==t&&this.goToAutomation(t),window.addEventListener("popstate",(t=>{"state"in t&&t.state&&"ID"in t.state?this.goToAutomation(t.state.ID):this.goToAutomation()}))}render(){if(this.state.isLoading)return(0,t.jsx)("div",{className:"loading-screen",children:(0,t.jsxs)("p",{children:[(0,t.jsx)("i",{className:"fas fa-spinner fa-pulse fa-lg"})," Loading..."]})});const e=new URLSearchParams(location.search).get("automation");return"new"===e?(0,t.jsxs)("div",{className:"ptc-completionist-automation-create",children:[(0,t.jsxs)("header",{children:[(0,t.jsxs)("button",{onClick:()=>this.goToAutomation(),children:[(0,t.jsx)("i",{className:"fas fa-angle-left"})," Back"]}),(0,t.jsx)("h1",{children:"New Automation"}),(0,t.jsx)("div",{className:"spacer"})]}),(0,t.jsx)(h,{goToAutomation:this.goToAutomation})]}):history.state&&"ID"in history.state&&history.state.ID==e?(0,t.jsxs)("div",{className:"ptc-completionist-automation-details",children:[(0,t.jsxs)("header",{children:[(0,t.jsxs)("button",{onClick:()=>this.goToAutomation(),children:[(0,t.jsx)("i",{className:"fas fa-angle-left"})," Back"]}),(0,t.jsxs)("h1",{children:["Edit Automation ",history.state.ID]}),(0,t.jsx)("div",{className:"spacer"})]}),(0,t.jsx)(h,{automation:history.state,goToAutomation:this.goToAutomation})]}):(0,t.jsx)(i,{automations:this.state.automations,goToAutomation:this.goToAutomation,deleteAutomation:this.deleteAutomation})}}const x=window.wp.element;document.addEventListener("DOMContentLoaded",(()=>{try{const e=document.getElementById("ptc-PTCCompletionistAutomations");null!==e&&(0,x.createRoot)(e).render((0,t.jsx)(j,{}))}catch(t){console.error(t)}}))})();